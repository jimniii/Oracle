
CREATE TABLE EMP(
    EMPNO NUMBER(4) PRIMARY KEY,
    NAME VARCHAR2(20) NOT NULL,
    GENDER CHAR(1) NOT NULL,
    JOB VARCHAR(20) NOT NULL,
    DEPTNO NUMBER(2),
    REGDATE DATE NOT NULL
    );
    
    DROP TABLE EMP;

CREATE TABLE DEPT(
    DEPTNO NUMBER(2) PRIMARY KEY,
    DNAME VARCHAR2(20) NOT NULL,
    DTEL VARCHAR2(12) NOT NULL
    );

    DROP TABLE DEPT;

CREATE TABLE SALE(
    NO NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY, 
    EMPNO NUMBER(4) NOT NULL,
    YEAR NUMBER(4) NOT NULL,
    MONTH NUMBER(2) NOT NULL,
    PRICE NUMBER(10)
    );
    
    DESC EMP;
    DESC DEPT;
    DESC SALE;
    
    ---------------------------------------------------------
    
    INSERT INTO EMP VALUES(1001,'김유신','M','사원',10,SYSDATE);
    INSERT INTO EMP VALUES(1002,'김춘추','M','대리',20,SYSDATE);
    INSERT INTO EMP VALUES(1003,'장보고','M','과장',10,SYSDATE);
    INSERT INTO EMP VALUES(1004,'강감찬','M','부장',30,SYSDATE);
    INSERT INTO EMP VALUES(1005,'신사임당','F','대리',20,SYSDATE);
    INSERT INTO EMP VALUES(1006,'이황','M','사원',40,SYSDATE);
    INSERT INTO EMP VALUES(1007,'이이','M','과장',20,SYSDATE);
    INSERT INTO EMP VALUES(1008,'이순신','M','사원',NULL,SYSDATE);
    INSERT INTO EMP VALUES(1009,'허난설현','F','사원',NULL,SYSDATE);
    INSERT INTO EMP VALUES(1010,'정약용','M','사원',50,SYSDATE);
    
    SELECT * FROM EMP;
    
    ---------------------------------------------------------
    
    INSERT INTO DEPT (DEPTNO,DNAME,DTEL) VALUES (10,'영업1부','051-511-1000');
    INSERT INTO DEPT (DEPTNO,DNAME,DTEL) VALUES (20,'영업2부','051-511-2000');
    INSERT INTO DEPT (DEPTNO,DNAME,DTEL) VALUES (30,'영업3부','051-511-3000');
    INSERT INTO DEPT (DEPTNO,DNAME,DTEL) VALUES (40,'영업4부','051-511-4000');
    INSERT INTO DEPT (DEPTNO,DNAME,DTEL) VALUES (50,'영업지원부','051-511-5000');
    
    SELECT * FROM DEPT;
    
    ---------------------------------------------------------
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1001,2023,1,98100);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1002,2023,1,136000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1003,2023,1,80000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1004,2023,1,78000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1005,2023,1,NULL);
    
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1001,2023,2,23500);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1002,2023,2,126000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1003,2023,2,18500);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1005,2023,2,19000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1010,2023,2,53000);
    
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1001,2024,1,24000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1002,2024,1,109000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1003,2024,1,80000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1004,2024,1,NULL);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1007,2024,1,24000);
    
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1002,2024,2,160000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1003,2024,2,101000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1004,2024,2,43000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1005,2024,2,24000);
    INSERT INTO SALE(EMPNO,YEAR,MONTH,PRICE) VALUES(1006,2024,2,109000);
    
    ---------------------------------------------------------
    SELECT * FROM SALE;
    
    SELECT * FROM EMP WHERE NAME = '김유신';
    SELECT * FROM EMP WHERE JOB = '차장' AND DEPTNO= 101;
    SELECT * FROM EMP WHERE JOB = '차장' OR DEPTNO =101;
    SELECT * FROM EMP WHERE NAME != '김춘추';
    SELECT * FROM EMP WHERE NAME <> '김춘추';
    SELECT * FROM EMP WHERE JOB = '사원' AND DEPTNO =101;
    SELECT * FROM EMP WHERE JOB ='사원' OR JOB = '대리';
    SELECT * FROM EMP WHERE DEPTNO IN (101,102,103);
    SELECT * FROM EMP WHERE NAME LIKE '김%';
    SELECT * FROM EMP WHERE NAME LIKE '%신';
    SELECT * FROM EMP WHERE NAME LIKE '_순%';
    // SELECT * FROM EMP WHERE HP LIKE '010-1111%'; //
    DESC EMP;
    SELECT * FROM EMP;
    SELECT * FROM EMP WHERE DEPTNO IS NOT NULL;
    SELECT * FROM EMP WHERE DEPTNO IS NULL;
    SELECT * FROM EMP WHERE EMPNO >= 1005;
    SELECT * FROM DEPT WHERE DEPTNO = 10;
    SELECT * FROM DEPT WHERE DTEL LIKE '%30%';
    SELECT * FROM DEPT WHERE DEPTNO IN (10,30); 
    SELECT * FROM DEPT WHERE DNAME LIKE '영업__';
    SELECT * FROM SALE WHERE PRICE > 50000;
    SELECT * FROM SALE WHERE PRICE >= 50000 AND PRICE < 100000 AND MONTH = 1;
    SELECT * FROM SALE WHERE PRICE NOT BETWEEN 50000 AND 100000;
    SELECT * FROM SALE WHERE YEAR = 2024;
    SELECT * FROM SALE WHERE YEAR = 2024 AND MONTH = 2;
    SELECT * FROM SALE WHERE MONTH IN (1,2);


    -- 실습하기 2-2
    SELECT * FROM SALE;
    SELECT * FROM EMP ORDER BY NAME;
    SELECT * FROM EMP ORDER BY REGDATE ASC;
    SELECT * FROM SALE ORDER BY PRICE DESC;
    
    SELECT * FROM SALE
        WHERE PRICE > 50000
        ORDER BY YEAR,MONTH, PRICE DESC;
        
    SELECT * FROM SALE FETCH FIRST 3 ROW ONLY;
    
    SELECT * FROM SALE OFFSET 0 ROWS FETCH NEXT 3 ROWS ONLY;
    SELECT * FROM SALE OFFSET 1 ROWS FETCH NEXT 2 ROWS ONLY; // 1번째 부터 2번째까지 (1,2) 자바 인덱스로 생각하몬 댐 !
    SELECT * FROM SALE OFFSET 5 ROWS FETCH NEXT 3 ROWS ONLY;
    
    
    
    SELECT * FROM SALE
    WHERE PRICE < 50000
    ORDER BY PRICE 
    DESC FETCH FIRST 3 ROWS ONLY;
    
    
    SELECT * FROM SALE
    WHERE PRICE > 50000
    ORDER BY YEAR DESC,MONTH,PRICE DESC
    FETCH FIRST 5 ROWS ONLY;
    
    
    -- 실습하기 2-3 중복제거 
    SELECT DISTINCT DEPTNO FROM EMP;
    SELECT DISTINCT JOB, DEPTNO FROM EMP;
    SELECT EMPNO AS 사번, NAME AS 이름, GENDER AS "성별" FROM EMP;
    SELECT EMPNO E, NAME N, GENDER G FROM EMP;
    
    
    -- 실습하기 3-1 다양한 SQL 숫자 함수 실습
    SELECT SUM(PRICE) AS 합계 FROM SALE;
    SELECT AVG(PRICE) AS 평균 FROM SALE;
    SELECT MAX(PRICE) AS "최댓값" FROM SALE;
    SELECT MIN(PRICE) AS "최솟값" FROM SALE;
    SELECT COUNT(*) AS 직원수 FROM EMP;
    SELECT COUNT(JOB) AS "정직원 수" FROM EMP;
    
    SELECT CEIL(1.2) FROM DUAL;
    SELECT CEIL(1.8) FROM DUAL;
    SELECT FLOOR(1.2) FROM DUAL;
    SELECT FLOOR(1.8) FROM DUAL;
    SELECT ROUND(1.2) FROM DUAL;
    SELECT ROUND(1.8) FROM DUAL;
    SELECT DBMS_RANDOM.VALUE FROM DUAL;
    SELECT CEIL(DBMS_RANDOM.VALUE*10) FROM DUAL;
    
    
    -- 실습하기 3-2 다양한 SQL 문자 함수 실습 
    SELECT 'HELLO ORACLE!', LENGTH('HELLO ORACLE!') FROM DUAL;
    
    
    //SUBSTR(문자열,N,M) ->N부터 M개
    SELECT 
    'HELLO ORACLE',
    SUBSTR('HELLO ORACLE!',1,3),
    SUBSTR('HELLO ORACLE!',3,2),
    SUBSTR('HELLO ORACLE!',5)
    FROM DUAL;
    
    SELECT 
    INSTR('HELLO ORACLE!','L') AS INSTR_1,
    INSTR('HELLO ORACLE!','L',-1) AS INSTR_2
    FROM DUAL;
    
    SELECT '010-1234-5678', REPLACE('010-1234-5678','-',' ') FROM DUAL;
    
    // (대상문자열,전체길이,패딩문자)
    SELECT LPAD('ORACLE',10,'#') AS LPAD, 
    RPAD('ORACLE',10,'*') AS RPAD 
    FROM DUAL; 
    
    SELECT CONCAT(EMPNO,NAME) FROM EMP WHERE NAME = '이순신';
    SELECT EMPNO || NAME FROM EMP WHERE NAME = '정약용';
    
    SELECT 
    '[ _ORACLE_ ]' AS BEFORE,
    '[' || TRIM ( '_ORACLE_') || ']' AS TRIM
    FROM DUAL;
    
    -- 실습하기 3-3 날짜함수
    
    SELECT SYSDATE,
    SYSDATE-1,
    SYSDATE+1
    FROM DUAL;
    
    SELECT ADD_MONTHS(SYSDATE,1),
    ADD_MONTHS(SYSDATE,-1)
    FROM DUAL;
    
    SELECT MONTHS_BETWEEN(DATE '2025-07-13', DATE '2024-07-13') AS 개월차
    FROM DUAL;
    
    SELECT SYSDATE -1 FROM DUAL;
    
    SELECT NEXT_DAY(SYSDATE, '월요일') AS 다음_월요일 FROM DUAL;
    
    --
    
    INSERT INTO EMP VALUES(1011,'안중근','M','부장',30, TO_CHAR(SYSDATE,'YYYY/MM/DD'));
    
    SELECT * FROM EMP;
    
    INSERT INTO EMP VALUES(1012,'유관순','F','차장','20',SYSDATE);
    INSERT INTO EMP VALUES(1013,'윤봉길','M','과장',30,SYSDATE);
    DELETE FROM EMP WHERE NAME = '윤봉길';
    
    SELECT * FROM EMP;
    
    -- 
    -- PRICE가 NULL이면 0 반환
    SELECT NO,EMPNO,YEAR,MONTH,NVL(PRICE,0) FROM SALE;
    SELECT * FROM SALE;
    
    -- DEPTNO가 NULL이면 비정규직 반환 NVL2(속성이름,NULL아닐때,NULL일때)
    SELECT EMPNO,NAME,GENDER,JOB,NVL2(DEPTNO,'정규직','비정규직') FROM EMP;
    
    
    -- 그룹화
    
    SELECT EMPNO FROM SALE GROUP BY EMPNO;
    SELECT YEAR FROM SALE GROUP BY YEAR;
    SELECT EMPNO, YEAR FROM SALE GROUP BY EMPNO, YEAR;
    SELECT EMPNO, COUNT(*) AS 판매건수 FROM SALE GROUP BY EMPNO;
    SELECT EMPNO, SUM(PRICE) AS 합계 FROM SALE GROUP BY EMPNO;
    SELECT EMPNO, AVG(PRICE) AS 평균 FROM SALE GROUP BY EMPNO;
    
    
    SELECT EMPNO ,YEAR,SUM(PRICE) AS 합계
    FROM SALE
    GROUP BY EMPNO,YEAR
    ORDER BY YEAR ASC, 합계 DESC;
    
    
    SELECT EMPNO, YEAR, SUM(PRICE) AS 합계
    FROM SALE
    WHERE PRICE >= 50000
    GROUP BY EMPNO, YEAR
    ORDER BY 합계 DESC;
    
    SELECT EMPNO,YEAR,SUM(PRICE) AS 합계 FROM SALE
    WHERE PRICE >=100000
    GROUP BY EMPNO,YEAR
    HAVING SUM(PRICE) >= 200000
    ORDER BY 합계 DESC;
    
    
    
    -- 실습하기 5-1
    SELECT EMPNO, MONTH, PRICE FROM SALE WHERE YEAR=2023
    UNION
    SELECT EMPNO,MONTH, PRICE FROM SALE WHERE YEAR=2024;
    
    SELECT EMPNO, MONTH, PRICE FROM SALE WHERE YEAR=2023
    UNION ALL
    SELECT EMPNO,MONTH, PRICE FROM SALE WHERE YEAR=2024;   
    
    SELECT EMPNO, YEAR, SUM(PRICE) AS 합계 FROM SALE
    WHERE YEAR = 2023
    GROUP BY EMPNO,YEAR
    UNION
    SELECT EMPNO,YEAR,SUM(PRICE) AS 합계 FROM SALE
    WHERE YEAR =2024
    GROUP BY EMPNO,YEAR
    ORDER BY YEAR ASC, 합계 DESC;
    
    SELECT EMPNO FROM SALE WHERE YEAR = 2023
    INTERSECT
    SELECT EMPNO FROM SALE WHERE YEAR = 2024;
    
    SELECT EMPNO FROM SALE WHERE YEAR = 2023
    MINUS
    SELECT EMPNO FROM SALE WHERE YEAR = 2024;
    
    
    
    
    -----
    
    
    SELECT * FROM EMP E
    JOIN DEPT D
    ON E.DEPTNO = D.DEPTNO;
    
    SELECT * FROM EMP E 
    JOIN DEPT D
    USING (DEPTNO);
    
    SELECT * FROM EMP E , DEPT D
    WHERE E.DEPTNO = D.DEPTNO;
    
    SELECT S.NO,
    S.EMPNO,
    E.NAME,
    E.JOB,
    E.REGDATE,
    E.DEPTNO,
    D.DNAME
    FROM SALE S
    JOIN EMP E ON S.EMPNO = E.EMPNO
    JOIN DEPT D ON E.DEPTNO = D.DEPTNO
    WHERE PRICE > 100000 AND YEAR = 2024
    ORDER BY S.PRICE DESC;
    
    SELECT * FROM SALE;
    
    SELECT * FROM SALE S
    LEFT JOIN EMP E
    ON S.EMPNO = E.EMPNO;
    
    
    SELECT * FROM SALE S
    RIGHT JOIN EMP E
    ON S.EMPNO = E.EMPNO;
    
    SELECT * FROM EMP;
    
    DELETE FROM EMP WHERE EMPNO = 1006;
    
    