
DROP TABLE MEMBER;
DROP TABLE BOOK;
DROP TABLE LOAN;

CREATE TABLE MEMBER(
MEMBER_ID NUMBER(4) PRIMARY KEY,
NAME VARCHAR2(40) NOT NULL,
ADDRESS VARCHAR2(100),
HP CHAR(13) UNIQUE,
JOIN_DATE DATE NOT NULL
);

CREATE TABLE BOOK(
BOOK_ID NUMBER(5) PRIMARY KEY,
TITLE VARCHAR2(50) NOT NULL,
AUTHOR VARCHAR2(40) NOT NULL,
PUBLISHER VARCHAR2(40) NOT NULL,
AVAILABLE CHAR(1),
REG_DATE DATE NOT NULL
);


CREATE TABLE LOAN(
LOAN_ID NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
MEMBER_ID NUMBER(4) NOT NULL,
BOOK_ID NUMBER(5) NOT NULL,
LOAN_DATE DATE,
RETURN_DATE DATE,
ACTUAL_DATE DATE,
FOREIGN KEY (MEMBER_ID) REFERENCES MEMBER(MEMBER_ID),
FOREIGN KEY (BOOK_ID) REFERENCES BOOK(BOOK_ID)
);

------------------------------------------------------------

INSERT INTO MEMBER VALUES(1001,'김유신','서울특별시 강남구 역삼동','010-1234-1001','2024-01-10 09:15:00');
INSERT INTO MEMBER VALUES(1002,'김춘추','대전광역시 유성구 장대동','010-1234-1002','2024-02-14 14:30:45');
INSERT INTO MEMBER VALUES(1003,'장보고','대구광역시 수성구 반월동','010-1234-1003','2024-03-01 11:05:20');
INSERT INTO MEMBER VALUES(1004,'강감찬','부산광역시 금정구 부곡동','010-1234-1004','2024-03-22 16:40:00');
INSERT INTO MEMBER VALUES(1005,'이순신','광주광역시 광산구 우산동','010-1234-1005','2024-04-10 08:50:10');

SELECT * FROM MEMBER;

INSERT INTO BOOK VALUES(10001,'태백산맥','조정래','문학수첩','Y','2014-01-10 09:15:00');
INSERT INTO BOOK VALUES(10002,'데미안','헤르만 헤세','민음사','N','2014-02-14 14:30:45');
INSERT INTO BOOK VALUES(10003,'토지','박경리','문학사상사','Y','2014-03-01 11:05:20');
INSERT INTO BOOK VALUES(10004,'명품 자바 프로그래밍','제임스 고슬링','한빛출판사','Y','2014-03-22 16:40:00');
INSERT INTO BOOK VALUES(10005,'로미오와 줄리엣','셰익스피어','열린책들','N','2014-04-10 08:50:10');
INSERT INTO BOOK VALUES(10006,'삼국지','나관중','민음사','Y','2014-04-05 09:12:02');
INSERT INTO BOOK VALUES(10007,'칼의 노래','김훈','문학동네','Y','2014-06-10 12:53:17');
INSERT INTO BOOK VALUES(10008,'데이터베이스','래리 엘리슨','한빛출판사','N','2014-05-23 10:13:09');
INSERT INTO BOOK VALUES(10009,'Linux 운영체제','리눌즈 토발즈','한빛출판사','Y','2014-03-11 11:23:43');
INSERT INTO BOOK VALUES(10010,'어린 왕자','생텍쥐베리','열린책들','Y','2014-05-13 15:27:21');
SELECT * FROM BOOK;

INSERT INTO LOAN VALUES(1,1001,10002,'2024-03-01 10:02:31','2024-03-15 10:02:31','2024-03-13 09:44:19');
INSERT INTO LOAN VALUES(2,1002,10004,'2024-03-05 15:10:02','2024-03-19 15:10:02','2024-03-12 17:12:30');
INSERT INTO LOAN VALUES(3,1003,10008,'2024-04-01 11:01:12','2024-04-15 11:01:12','');
INSERT INTO LOAN VALUES(4,1002,10001,'2024-04-10 14:32:01','2024-04-24 14:32:01','2024-04-22 13:56:32');
INSERT INTO LOAN VALUES(5,1005,10004,'2024-04-15 16:24:21','2024-04-29 16:24:21','');
INSERT INTO LOAN VALUES(6,1004,10006,'2024-05-01 09:12:09','2024-05-15 09:12:09','2024-05-14 09:21:27');
INSERT INTO LOAN VALUES(7,1001,10007,'2024-05-03 13:51:07','2024-05-17 13:51:07','2024-05-17 14:05:10');
INSERT INTO LOAN VALUES(8,1003,10009,'2024-06-01 11:15:43','2024-06-15 11:15:43','');
INSERT INTO LOAN VALUES(9,1004,10004,'2024-06-02 12:30:52','2024-06-16 12:30:52','');
INSERT INTO LOAN VALUES(10,1002,10008,'2024-06-05 10:06:17','2024-06-19 10:06:17','');
SELECT * FROM LOAN;


-- 4
SELECT * FROM MEMBER;

-- 5
SELECT TITLE,AUTHOR FROM BOOK;


-- 6
SELECT NAME,ADDRESS FROM MEMBER WHERE ADDRESS LIKE '부산%';

-- 7
SELECT TITLE FROM BOOK WHERE AVAILABLE = 'Y';

-- 8
SELECT * FROM BOOK WHERE BOOK_ID = 10005;

-- 9
SELECT MEMBER_ID,NAME,HP FROM MEMBER WHERE MEMBER_ID = 1002;

-- 10
SELECT TITLE FROM BOOK WHERE REG_DATE LIKE '2014-03%';

-- 11
SELECT TITLE,AUTHOR, PUBLISHER FROM BOOK WHERE PUBLISHER ='민음사';


-- 12
SELECT LOAN_ID,MEMBER_ID, BOOK_ID 
FROM LOAN
WHERE ACTUAL_DATE IS NULL;


-- 13
SELECT * FROM MEMBER 
WHERE NAME LIKE '김%';


-- 14
SELECT NAME,ADDRESS FROM MEMBER
WHERE ADDRESS LIKE '대구%' OR ADDRESS LIKE '부산%';


-- 15
SELECT BOOK_ID, TITLE FROM BOOK
WHERE BOOK_ID = 10003 OR BOOK_ID = 10006;

-- 16
SELECT TITLE,AUTHOR FROM BOOK
WHERE AUTHOR = '조정래' OR AUTHOR = '박경리';


-- 17
SELECT NAME,JOIN_DATE FROM MEMBER
WHERE JOIN_DATE < '2024-04-01';

-- 18
SELECT LOAN_ID, MEMBER_ID, BOOK_ID, LOAN_DATE FROM LOAN
WHERE LOAN_DATE > '2024-05-01';

-- 19
SELECT TITLE,AUTHOR,PUBLISHER FROM BOOK
WHERE AVAILABLE = 'N';

-- 20
SELECT * FROM BOOK
WHERE TITLE LIKE '%자바%';


-- 21
SELECT NAME,HP FROM MEMBER
WHERE HP != '010-1234-1003';


-- 22
SELECT LOAN_ID,MEMBER_ID,BOOK_ID FROM LOAN
WHERE RETURN_DATE < '2024-03-20';


-- 23
SELECT * FROM MEMBER
ORDER BY NAME ASC;

-- 24
SELECT TITLE, REG_DATE FROM BOOK
ORDER BY REG_DATE DESC;

-- 25
SELECT TITLE FROM BOOK 
ORDER BY TITLE ASC
FETCH FIRST 3 ROWS ONLY;


-- 26
SELECT * FROM MEMBER
ORDER BY JOIN_DATE DESC
FETCH FIRST 1 ROWS ONLY;


-- 27
SELECT LOAN_ID, LOAN_DATE FROM LOAN
ORDER BY LOAN_DATE ASC
FETCH FIRST 2 ROWS ONLY;

-- 28
SELECT COUNT(*) FROM MEMBER;

-- 29
SELECT COUNT(*) FROM BOOK;

-- 30
SELECT COUNT(*) FROM BOOK
WHERE AVAILABLE = 'Y';

-- 31
SELECT PUBLISHER, COUNT(PUBLISHER) "출판_도서수" FROM BOOK
GROUP BY PUBLISHER;

-- 32
SELECT COUNT(*) FROM LOAN
WHERE LOAN_DATE LIKE '2024%';


-- 33
SELECT MEMBER_ID, COUNT(BOOK_ID) "대출_도서수" FROM LOAN
GROUP BY MEMBER_ID;

-- 34
SELECT BOOK_ID, COUNT(BOOK_ID) "대출횟수" FROM LOAN
GROUP BY BOOK_ID;

-- 35
SELECT MEMBER_ID, COUNT(BOOK_ID) FROM LOAN
GROUP BY MEMBER_ID
HAVING COUNT(BOOK_ID)>=2;


-- 36
SELECT BOOK_ID, COUNT(BOOK_ID) FROM LOAN
GROUP BY BOOK_ID
HAVING COUNT(BOOK_ID)>=2;

-- 37
SELECT L.MEMBER_ID,M.NAME,L.BOOK_ID,B.TITLE,L.LOAN_DATE
FROM LOAN L
JOIN BOOK B
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID;


-- 38
SELECT M.NAME, COUNT(M.NAME) "대출건수" FROM MEMBER M
JOIN LOAN L
ON M.MEMBER_ID = L.MEMBER_ID
GROUP BY M.NAME
HAVING COUNT(M.NAME) >=3;

-- 39
SELECT L.LOAN_ID, M.NAME, B.TITLE,L.LOAN_DATE FROM LOAN L
JOIN BOOK B
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID
WHERE L.LOAN_DATE < '2024-05-01';

-- 40
SELECT B.TITLE FROM BOOK B
JOIN LOAN L
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID
WHERE M.NAME='김유신';

-- 41
SELECT M.NAME FROM BOOK B
JOIN LOAN L
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID
WHERE B.TITLE ='태백산맥';

-- 42
SELECT M.NAME,B.TITLE FROM BOOK B
JOIN LOAN L
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID
WHERE M.NAME ='김춘추'
ORDER BY B.TITLE;

-- 43
SELECT B.TITLE, M.NAME FROM BOOK B
JOIN LOAN L
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID
WHERE L.LOAN_DATE LIKE '2024-04%';


-- 44
SELECT M.NAME, B.TITLE FROM BOOK B
JOIN LOAN L
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID
WHERE L.ACTUAL_DATE IS NULL;

-- 45
SELECT M.NAME, B.TITLE FROM BOOK B
JOIN LOAN L
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID
WHERE B.AUTHOR = '조정래';

-- 46 ★
SELECT B.BOOK_ID, B.TITLE FROM BOOK B
LEFT JOIN LOAN L
ON B.BOOK_ID = L.BOOK_ID
WHERE LOAN_ID IS NULL;


-- 47
SELECT M.NAME, COUNT(M.NAME) "총_건수" FROM BOOK B
JOIN LOAN L
ON B.BOOK_ID = L.BOOK_ID
JOIN MEMBER M
ON M.MEMBER_ID = L.MEMBER_ID
GROUP BY M.NAME
ORDER BY COUNT(M.NAME) DESC;


-- 48  ★
SELECT NAME FROM MEMBER WHERE MEMBER_ID=(
SELECT MEMBER_ID FROM LOAN 
GROUP BY MEMBER_ID 
ORDER BY COUNT(*) DESC
FETCH FIRST 1 ROWS ONLY
);


-- 49 

SELECT TITLE FROM BOOK
WHERE PUBLISHER = 
(SELECT PUBLISHER FROM BOOK
WHERE TITLE ='데이터베이스')
AND TITLE != '데이터베이스';

-- 50

SELECT NAME FROM MEMBER
WHERE MEMBER_ID IN
(SELECT L.MEMBER_ID FROM LOAN L
JOIN BOOK B ON B.BOOK_ID = L.BOOK_ID
WHERE L.BOOK_ID = 10004);



